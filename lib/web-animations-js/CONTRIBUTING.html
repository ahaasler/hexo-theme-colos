<h2 id="Developer-setup-instructions"><a href="#Developer-setup-instructions" class="headerlink" title="Developer setup instructions"></a>Developer setup instructions</h2><ol>
<li><code>git clone git@github.com:web-animations/web-animations-next.git</code></li>
<li><code>git submodule update --init --recursive</code> (Necessary for running tests.)</li>
<li>Install <a href="https://nodejs.org/en/">node</a> and make sure <code>npm</code> is in your $PATH</li>
<li>Run <code>npm install</code> in the respository to pull in development dependencies.</li>
<li>Run <code>npm install -g grunt grunt-cli</code> to get the build tools for the command line.</li>
<li>Run <code>grunt</code> to build the polyfill.</li>
<li>Run <code>grunt test</code> to run polyfill and web-platform-tests tests.</li>
</ol>
<h2 id="Debugging-tests"><a href="#Debugging-tests" class="headerlink" title="Debugging tests"></a>Debugging tests</h2><p>You can run the tests in an interactive mode with <code>grunt debug</code>. This starts the<br>Karma server once for each polyfill target for each test framework.<br>Navigate to <code>http://localhost:9876/debug.html</code> to open the test runner in your<br>browser of choice, all test results appear in the Javascript console.<br>Test failures can be accessed via <code>window.failures</code> and <code>window.formattedFailures</code><br>once the tests have completed.</p>
<p>The polyfill target and tests can be specified as arguments to the <code>debug</code> task.<br>Example: <code>grunt debug:web-animations-next:test/web-platform-tests/web-animations/animation/pause.html</code><br>Multiple test files may be listed with comma separation. Specifying files will output their URL in the command line.<br>Example: <code>http://localhost:9876/base/test/web-platform-tests/web-animations/animation/pause.html</code></p>
<h2 id="Design-notes"><a href="#Design-notes" class="headerlink" title="Design notes"></a>Design notes</h2><p><a href="https://drive.google.com/folderview?id=0B9rpPoIDv3vTNlZxOVp6a2tNa1E&amp;usp=sharing">Design diagrams</a></p>
<h2 id="Publishing-a-release"><a href="#Publishing-a-release" class="headerlink" title="Publishing a release"></a>Publishing a release</h2><ol>
<li><p>Determine the version number for the release</p>
<ul>
<li>Increment the first number and reset others to 0 when there are large breaking changes</li>
<li>Increment the second number and reset the third to 0 when there are significant new, but backwards compatible features</li>
<li>Otherwise, increment the third number</li>
</ul>
</li>
<li><p>Add versioned release notes to <code>History.md</code>, for example:</p>
<pre><code>### 3.13.37 — *November 1, 2001*

  * Fixed a bug where nothing worked
</code></pre><p>Use the following to generate a summary of commits, but edit the list to contain only<br>relevant information.</p>
<pre><code>git log --first-parent `git describe --tags --abbrev=0 web-animations-js/master`..web-animations-next/master --pretty=format:&quot;  * %s&quot;
</code></pre></li>
<li><p>Specify the new version inside <code>package.json</code> (for NPM), for example:</p>
<pre><code class="js"><span class="string">"version"</span>: <span class="string">"3.13.37"</span>,
</code></pre>
</li>
<li><p>Build the polyfill with <code>npm install &amp;&amp; grunt</code> then update <code>README.md</code>‘s Build Target Comparison with the current gzipped sizes.</p>
</li>
<li><p>Submit both changes to web-animations-next then follow the procedure to push from web-animations-next to web-animations-js.</p>
</li>
<li><p>Draft a <a href="https://github.com/web-animations/web-animations-js/releases">new release</a> at the<br>commit pushed to web-animations-js in step #4. Copy the release notes from <code>History.md</code><br>added in step #2.</p>
</li>
<li><p>Once you’ve pushed to web-animations-js, run <code>npm publish</code> from that checked-out folder</p>
<p>To do this, you’ll need to be a collaborator <a href="https://www.npmjs.com/package/web-animations-js">on the NPM project</a>, or have a collaborator help you.</p>
</li>
<li><p>If there are any breaking changes to the API in this release you must notify web-animations-changes@googlegroups.com.</p>
<p>Only owners of the group may post to it so you may need to request ownership or ask someone to post it for you.</p>
</li>
</ol>
<h2 id="Pushing-from-web-animations-next-to-web-animations-js"><a href="#Pushing-from-web-animations-next-to-web-animations-js" class="headerlink" title="Pushing from web-animations-next to web-animations-js"></a>Pushing from web-animations-next to web-animations-js</h2><pre><code>git fetch web-animations-next
git fetch web-animations-js
git checkout web-animations-js/master
git merge web-animations-next/master --no-edit --quiet
npm install
grunt
# Optional &quot;grunt test&quot; to make sure everything still passes.
git add -f *.min.js*
git rm .gitignore
git commit -m &apos;Add build artifacts from &apos;`cat .git/refs/remotes/web-animations-next/master`
git push web-animations-js HEAD:refs/heads/master
</code></pre><h2 id="Testing-architecture"><a href="#Testing-architecture" class="headerlink" title="Testing architecture"></a>Testing architecture</h2><p>This is an overview of what happens when <code>grunt test</code> is run.</p>
<ol>
<li>Polyfill tests written in mocha and chai are run.<ol>
<li>grunt creates a karma config with mocha and chai adapters.</li>
<li>grunt adds the test/js files as includes to the karma config.</li>
<li>grunt starts the karma server with the config and waits for the result.</li>
<li>The mocha adaptor runs the included tests and reports the results to karma.</li>
<li>karma outputs results to the console and returns the final pass/fail result to grunt.</li>
</ol>
</li>
<li>web-platform-tests/web-animations tests written in testtharness.js are run.<ol>
<li>grunt creates a karma config with karma-testharness-adaptor.js included.</li>
<li>grunt adds the web-platform-tests/web-animations files to the custom testharnessTests config in the karma config.</li>
<li>grunt adds failure expectations to the custom testharnessTests config in the karma config.</li>
<li>grunt starts the karma server with the config and waits for the result.</li>
<li>The testharness.js adaptor runs the included tests (ignoring expected failures) and reports the results to karma.</li>
<li>karma outputs results to the console and returns the final pass/fail result to grunt.</li>
</ol>
</li>
<li>grunt exits successfully if both test runs passed.</li>
</ol>
