<h2 id="Developer-instructions"><a href="#Developer-instructions" class="headerlink" title="Developer instructions"></a>Developer instructions</h2><h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><ol>
<li>Fork web-animations/web-animations-js.</li>
<li><code>git clone git@github.com:$GITHUB_USER/web-animations-js.git</code></li>
<li><code>git submodule update --init --recursive</code> (Necessary for running tests.)</li>
<li>Install <a href="https://nodejs.org/en/">node</a> and make sure <code>npm</code> is in your $PATH</li>
<li>Run <code>npm install</code> in the respository to pull in development dependencies.</li>
<li>Run <code>npm install -g grunt-cli</code> to get the build tools for the command line.</li>
</ol>
<h3 id="Contributing"><a href="#Contributing" class="headerlink" title="Contributing"></a>Contributing</h3><p>Note that development should occur against the <code>dev</code> branch, not <code>master</code>. This<br>is the default target for pull requests.</p>
<ol>
<li>In your fork of web-animations-js, <code>git checkout dev</code> or create a new branch whose parent is dev.</li>
<li>Run <code>grunt</code> to build the polyfill.</li>
<li>Run <code>grunt test</code> to run polyfill and web-platform-tests tests.</li>
<li>Commit changes to your fork.</li>
<li>Create a pull request from your fork of web-animations-js to<br><a href="https://github.com/web-animations/web-animations-js/tree/dev">web-animations/web-animations-js/dev</a>.</li>
<li>Ensure that you’ve signed the <a href="https://cla.developers.google.com/clas">Google Contributor License Agreement</a>.</li>
</ol>
<h2 id="Debugging-tests"><a href="#Debugging-tests" class="headerlink" title="Debugging tests"></a>Debugging tests</h2><p>You can run the tests in an interactive mode with <code>grunt debug</code>. This starts the<br>Karma server once for each polyfill target for each test framework.<br>Navigate to <code>http://localhost:9876/debug.html</code> to open the test runner in your<br>browser of choice, all test results appear in the Javascript console.<br>Test failures can be accessed via <code>window.failures</code> and <code>window.formattedFailures</code><br>once the tests have completed.</p>
<p>The polyfill target and tests can be specified as arguments to the <code>debug</code> task.<br>Example: <code>grunt debug:web-animations-next:test/web-platform-tests/web-animations/animation/pause.html</code><br>Multiple test files may be listed with comma separation. Specifying files will output their URL in the command line.<br>Example: <code>http://localhost:9876/base/test/web-platform-tests/web-animations/animation/pause.html</code></p>
<h2 id="Design-notes"><a href="#Design-notes" class="headerlink" title="Design notes"></a>Design notes</h2><p><a href="https://drive.google.com/folderview?id=0B9rpPoIDv3vTNlZxOVp6a2tNa1E&amp;usp=sharing">Design diagrams</a></p>
<h2 id="Publishing-a-release"><a href="#Publishing-a-release" class="headerlink" title="Publishing a release"></a>Publishing a release</h2><ol>
<li><p>Determine the version number for the release</p>
<ul>
<li>Increment the first number and reset others to 0 when there are large breaking changes</li>
<li>Increment the second number and reset the third to 0 when there are significant new, but backwards compatible features</li>
<li>Otherwise, increment the third number</li>
</ul>
</li>
<li><p>Add versioned release notes to <code>History.md</code>, for example:</p>
<pre><code>### 3.13.37 — *November 1, 2001*

  * Fixed a bug where nothing worked
</code></pre><p>Use the following to generate a summary of commits, but edit the list to contain only<br>relevant information.</p>
<pre><code>git log --first-parent `git describe --tags --abbrev=0 master`..dev --pretty=format:&quot;  * %s&quot;
</code></pre></li>
<li><p>Specify the new version inside <code>package.json</code> (for NPM), for example:</p>
<pre><code class="js"><span class="string">"version"</span>: <span class="string">"3.13.37"</span>,
</code></pre>
</li>
<li><p>Build the polyfill with <code>npm install &amp;&amp; grunt</code> then update <code>docs/experimental.md</code>‘s Build Target Comparison with the current gzipped sizes.</p>
</li>
<li><p>Commit the above changes to web-animations-js/dev and merge to<br>web-animations-js/master.</p>
<pre><code class="sh">git checkout master
git merge dev --no-edit --quiet
</code></pre>
</li>
<li><p>Build and commit minified JavaScript files.</p>
<pre><code class="sh">npm install
grunt
<span class="comment"># Optional "grunt test" to make sure everything still passes.</span>
git add <span class="_">-f</span> *.min.js{,.map}
git rm .gitignore
git commit -m <span class="string">'Add build artifacts from '</span>`cat .git/refs/heads/dev`
git push HEAD:refs/heads/master
</code></pre>
</li>
<li><p>Draft a <a href="https://github.com/web-animations/web-animations-js/releases">new release</a> at the<br>commit pushed to web-animations-js in step #4. Copy the release notes from <code>History.md</code><br>added in step #2.</p>
</li>
<li><p>Once you’ve pushed to web-animations-js, run <code>npm publish</code> from that checked-out folder</p>
<p>To do this, you’ll need to be a collaborator <a href="https://www.npmjs.com/package/web-animations-js">on the NPM project</a>, or have a collaborator help you.</p>
</li>
<li><p>If there are any breaking changes to the API in this release you must notify web-animations-changes@googlegroups.com.</p>
<p>Only owners of the group may post to it so you may need to request ownership or ask someone to post it for you.</p>
</li>
</ol>
<h2 id="Testing-architecture"><a href="#Testing-architecture" class="headerlink" title="Testing architecture"></a>Testing architecture</h2><p>This is an overview of what happens when <code>grunt test</code> is run.</p>
<ol>
<li>Polyfill tests written in mocha and chai are run.<ol>
<li>grunt creates a karma config with mocha and chai adapters.</li>
<li>grunt adds the test/js files as includes to the karma config.</li>
<li>grunt starts the karma server with the config and waits for the result.</li>
<li>The mocha adaptor runs the included tests and reports the results to karma.</li>
<li>karma outputs results to the console and returns the final pass/fail result to grunt.</li>
</ol>
</li>
<li>web-platform-tests/web-animations tests written in testtharness.js are run.<ol>
<li>grunt creates a karma config with karma-testharness-adaptor.js included.</li>
<li>grunt adds the web-platform-tests/web-animations files to the custom testharnessTests config in the karma config.</li>
<li>grunt adds failure expectations to the custom testharnessTests config in the karma config.</li>
<li>grunt starts the karma server with the config and waits for the result.</li>
<li>The testharness.js adaptor runs the included tests (ignoring expected failures) and reports the results to karma.</li>
<li>karma outputs results to the console and returns the final pass/fail result to grunt.</li>
</ol>
</li>
<li>grunt exits successfully if both test runs passed.</li>
</ol>
